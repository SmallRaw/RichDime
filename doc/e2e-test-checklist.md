# Rich Dime E2E 测试清单

> 手动验证清单，覆盖所有已实现功能的关键路径和边界情况。
> 每次发版前逐项检查，在 `[ ]` 中标记 `[x]` 表示通过。

## E2E 测试方式：Chrome MCP

当用户要求执行 E2E 测试时，**必须使用 Chrome DevTools MCP** 进行验证，步骤如下：

1. 启动 Expo Web 开发服务器：`pnpm exec expo start --web --port 8081 -c`
2. 通过 Chrome MCP `navigate_page` 打开 `http://localhost:8081`
3. 设置移动端视口模拟：`emulate({ viewport: { width: 390, height: 844, deviceScaleFactor: 3, hasTouch: true, isMobile: true } })`
4. 逐页导航并使用 `take_snapshot` + `take_screenshot` 验证页面渲染
5. 需要验证的核心页面：
   - `/add-transaction` — 记账页
   - `/(tabs)` — 流水列表页
   - `/(tabs)/statistics` — 统计页

### 已知限制

- Chrome MCP 的 `click` 无法触发 React Native Web 的 `Pressable.onPress`（RNW Responder System 只接受浏览器原生 trusted 事件，CDP 派发的事件 `isTrusted: false` 被忽略）
- 因此交互测试（点击按钮、输入数据、表单提交）需在真机/模拟器上手动完成
- 根路由 `/` 可能显示空白，直接导航到具体路由即可

---

## 1. 应用启动与初始化

- [ ] 冷启动：App 能正常启动，无白屏或崩溃
- [ ] 冷启动：splash → 主界面过渡无闪烁（无 spinner / 无"正在初始化"文字）
- [ ] 启动行为：冷启动后自动弹出添加交易页面
- [ ] 启动行为：关闭添加交易 Modal 后回到流水页（Transactions tab）
- [ ] 数据库初始化：首次安装后 SQLite 数据库正确创建
- [ ] 默认数据：系统默认分类（支出/收入）已预置
- [ ] 默认账户：至少一个默认账户存在
- [ ] 底部 Tab 栏：「流水」和「统计」两个 Tab 可见，FAB (+) 按钮居中显示
- [ ] 深色模式：切换系统主题后 App 正确响应（浅色 ↔ 深色）

---

## 2. 流水页（Transactions Screen）

### 2.1 空状态

- [ ] 无交易记录时显示空状态提示
- [ ] 空状态下 FAB (+) 可点击，能进入记账页面

### 2.2 周期切换

- [ ] 默认显示「月」视图
- [ ] 切换到「周」：汇总金额仅包含本周数据
- [ ] 切换到「月」：汇总金额仅包含本月数据
- [ ] 切换到「年」：汇总金额仅包含本年数据
- [ ] 切换周期后，交易列表对应过滤

### 2.3 交易列表

- [ ] 交易按日期倒序排列（最新在上）
- [ ] 日期分组标题正确（TODAY / YESTERDAY / 具体日期）
- [ ] 每个日期分组显示当日支出小计
- [ ] 支出金额显示为红色（负数）
- [ ] 收入金额显示为绿色（正数）
- [ ] 转账金额显示为蓝色
- [ ] 每条记录显示：分类图标 + 分类名 + 备注/时间 + 金额
- [ ] 转账记录显示：源账户 → 目标账户

### 2.4 搜索

- [ ] 搜索栏可展开/收起
- [ ] 输入关键字后（如「咖啡」），列表实时过滤
- [ ] 搜索结果只包含备注匹配的交易
- [ ] 清空搜索后恢复完整列表

### 2.5 分页与刷新

- [ ] 列表滚动到底部自动加载更多（每页 20 条）
- [ ] 加载更多时显示 loading indicator
- [ ] 所有数据加载完毕后不再触发加载
- [ ] 下拉刷新正常工作，数据更新

### 2.6 删除交易

- [ ] 长按交易条目弹出确认对话框
- [ ] 对话框显示交易详情（分类 + 金额）
- [ ] 取消删除：交易保留不变
- [ ] 确认删除：交易从列表移除
- [ ] 删除支出后：对应账户余额增加
- [ ] 删除收入后：对应账户余额减少
- [ ] 删除转账后：源账户余额增加，目标账户余额减少

---

## 3. 记账页（Add Transaction Screen）

### 3.1 基础交互

- [ ] 点击 FAB (+) 打开记账 Modal
- [ ] 默认选中「支出」类型
- [ ] 默认账户已选中
- [ ] 默认分类已选中（支出类第一个）
- [ ] 日期默认为当前时间

### 3.2 类型切换

- [ ] 切换到「收入」：分类列表更新为收入分类
- [ ] 切换到「转账」：出现源账户和目标账户选择器
- [ ] 从「支出」切到「收入」：分类重置
- [ ] 从「收入」切到「转账」：分类自动选择转账分类

### 3.3 金额输入（Numpad）

- [ ] 数字键 0-9 正常输入
- [ ] 小数点输入：最多 2 位小数
- [ ] 不能输入多个小数点
- [ ] 金额上限 10 位数字
- [ ] 删除键逐位删除
- [ ] 初始显示 0.00
- [ ] 金额格式化显示正确（¥ 前缀）

### 3.4 备注与智能建议

- [ ] 备注输入框可输入文字
- [ ] 输入 300ms 后触发历史搜索
- [ ] 匹配的历史备注以 chip 形式横向展示
- [ ] 点击建议 chip：自动填充金额 + 分类 + 类型
- [ ] 备注可以为空提交

### 3.5 分类选择

- [ ] 点击分类选择器弹出 CategoryPopover
- [ ] 分类以 emoji 网格形式展示
- [ ] 仅显示当前类型（支出/收入）的分类
- [ ] 选中后 popover 关闭，分类更新
- [ ] Popover 中有「编辑」按钮，点击跳转编辑分类页

### 3.6 日期时间选择

- [ ] 日期选择器展示正确日期
- [ ] 可选择 Today / Yesterday 快捷选项
- [ ] Wheel Picker 滚动选择自定义日期
- [ ] 时间选择正常（小时/分钟）
- [ ] 滚动选择后：轮盘停留在用户选择的位置，不弹回初始值
- [ ] 选择非今天日期后保存，交易记录到正确日期
- [ ] 选择时间后保存，交易记录到正确时间
- [ ] 选择过去日期：交易记录到对应日期

### 3.7 循环记账

- [ ] 默认为「不循环」
- [ ] 可选择：每天 / 每周 / 每月
- [ ] 可设置自定义间隔
- [ ] 选择循环后提示信息展示正确

### 3.8 转账特殊逻辑

- [ ] 转账模式下显示源账户和目标账户
- [ ] 目标账户列表排除源账户（不能转给自己）
- [ ] 转账提交后：源账户余额减少，目标账户余额增加
- [ ] 金额显示在两个账户之间

### 3.9 提交验证

- [ ] 金额为 0 时不能提交
- [ ] 未选择分类时不能提交
- [ ] 正常提交后 Modal 关闭
- [ ] 提交后流水页自动刷新，新交易出现在列表顶部
- [ ] 提交后账户余额正确更新

---

## 4. 统计页（Statistics Screen）

### 4.1 周期切换

- [ ] 默认显示「月」统计
- [ ] 切换到「周」：数据范围为本周（周一至周日）
- [ ] 切换到「月」：数据范围为本月
- [ ] 切换到「年」：数据范围为本年

### 4.2 概览卡片

- [ ] 显示当前周期总支出
- [ ] 显示当前周期净额（收入 - 支出）
- [ ] 金额格式化正确（¥ + 千分位）

### 4.3 支出趋势图（Bar Chart）

- [ ] 周视图：7 根柱子（周一 ~ 周日）
- [ ] 月视图：28~31 根柱子（根据月份天数）
- [ ] 年视图：12 根柱子（1月 ~ 12月）
- [ ] 有支出的柱子高度与金额成比例
- [ ] 无支出的柱子为最小高度
- [ ] 当前日期/月份的柱子高亮

### 4.4 分类分布

- [ ] 展示支出分类占比
- [ ] 每个分类显示：颜色圆点 + 名称 + 金额
- [ ] 分类横向滚动，两行网格
- [ ] 无支出分类不显示
- [ ] 总额与概览卡片一致

### 4.5 支出排行

- [ ] 显示当前周期前 20 笔支出
- [ ] 按金额降序排列
- [ ] 标题显示「按金额排序」
- [ ] 每条显示分类图标 + 备注 + 金额

### 4.6 周期导航（左右滑动）

- [ ] 右滑切换到上一周/月/年
- [ ] 左滑切换到下一周/月/年（不超过当前）
- [ ] 切换周/月/年 Tab 后偏移重置为当前
- [ ] 标题随周期和偏移正确更新
- [ ] 周视图标题格式：`YYYY年M月D日`
- [ ] 月视图标题格式：`YYYY年M月`
- [ ] 年视图标题格式：`YYYY年`
- [ ] 滑动到历史月份后柱状图天数正确（如2月28/29天）
- [ ] 不同周期的统计数据与实际交易匹配
- [ ] 跨年份滑动数据正确

### 4.7 统计数据准确性（跨年/跨月验证）

- [ ] 在不同年份记账后，切换到对应年份统计数据正确
- [ ] 在不同月份记账后，切换到对应月份统计数据正确
- [ ] 在不同周记账后，切换到对应周统计数据正确
- [ ] 柱状图各柱子金额与实际交易金额匹配

### 4.8 空数据状态

- [ ] 无交易数据时图表区域显示合理（空柱子/提示）
- [ ] 无分类数据时分类分布区域不崩溃
- [ ] 无排行数据时排行列表显示空状态

---

## 5. 分类管理（Edit Categories）

### 5.1 分类列表

- [ ] 从记账页分类选择器点击「编辑」进入
- [ ] 默认显示「支出」分类 Tab
- [ ] 每个分类显示：Emoji + 名称 + 颜色色块
- [ ] 点击分类进入编辑页

### 5.2 Tab 切换

- [ ] 切换到「收入」Tab：显示收入分类
- [ ] 切换到「支出」Tab：显示支出分类
- [ ] 两个 Tab 下的分类互不混淆

### 5.3 推荐分类

- [ ] 显示尚未添加的推荐分类
- [ ] 支出/收入各有不同的推荐列表
- [ ] 已存在的分类不出现在推荐中
- [ ] 点击 + 按钮快速添加推荐分类
- [ ] 添加后该推荐从列表消失，主列表刷新

### 5.4 新建分类

- [ ] 点击底部「New」按钮进入新建分类页
- [ ] 默认类型与当前 Tab 一致

---

## 6. 分类表单（Category Form）

### 6.1 新建模式

- [ ] 类型选择器可切换（支出/收入）
- [ ] Emoji 显示区域展示当前 emoji
- [ ] 点击颜色色块循环切换 14 种颜色
- [ ] 输入分类名称
- [ ] 名称为空时不能提交
- [ ] 提交后分类创建成功，返回分类列表

### 6.2 编辑模式

- [ ] 预填充现有分类信息（名称、emoji、颜色、类型）
- [ ] 类型选择器禁用（不可修改）
- [ ] 修改名称/颜色后提交，更新成功
- [ ] 删除按钮可见

### 6.3 删除分类

- [ ] 系统分类不能删除（提示用户）
- [ ] 有交易记录的分类不能删除（提示归档）
- [ ] 有子分类的分类不能删除
- [ ] 可删除的分类：确认后删除成功
- [ ] 删除后返回分类列表，该分类消失

---

## 7. 数据一致性验证

### 7.1 账户余额

- [ ] 新建支出：账户余额 = 原余额 - 支出金额
- [ ] 新建收入：账户余额 = 原余额 + 收入金额
- [ ] 新建转账：源账户余额减少，目标账户余额增加，总余额不变
- [ ] 删除交易后余额正确回退
- [ ] 连续多笔操作后余额累计正确

### 7.2 统计数据

- [ ] 统计页总支出 = 流水页同周期支出之和
- [ ] 分类占比之和 = 100%（允许四舍五入误差）
- [ ] 切换周期后统计数据与实际交易匹配

### 7.3 跨页面一致性

- [ ] 记账后返回流水页，新交易立即可见
- [ ] 删除交易后切到统计页，统计数据已更新
- [ ] 修改分类后，流水页中该分类的交易显示新名称/图标

---

## 8. 边界情况与异常

### 8.1 金额边界

- [ ] 输入极小金额 ¥0.01：正常保存和显示
- [ ] 输入较大金额 ¥9,999,999.99：正常保存和显示
- [ ] 小数点后只输入 1 位（如 ¥5.5）：保存为 ¥5.50

### 8.2 文本边界

- [ ] 备注输入超长文字（100+ 字符）：正常保存，UI 截断显示
- [ ] 备注包含特殊字符（emoji、换行符）：正常保存
- [ ] 分类名使用中英文混合：正常创建

### 8.3 日期边界

- [ ] 选择跨年日期（如 12/31 → 1/1）：正确归属年份
- [ ] 选择跨月日期：正确归属月份
- [ ] 选择过去的日期记账：交易出现在正确的日期分组

### 8.4 并发操作

- [ ] 快速连续点击提交按钮：不会重复创建交易
- [ ] 快速切换 Tab：不会崩溃或显示错误数据

### 8.5 数据量

- [ ] 100+ 条交易：列表滚动流畅，分页正常
- [ ] 500+ 条交易：统计计算正常，无明显卡顿
- [ ] 50+ 个分类：分类选择器正常展示

---

## 9. UI / UX 验证

### 9.1 响应式

- [ ] 小屏设备（iPhone SE）：所有元素不溢出
- [ ] 大屏设备（iPhone 16 Pro Max）：布局合理
- [ ] 横屏模式：不崩溃（即使布局不完美）

### 9.2 手势交互

- [ ] Modal 下滑关闭正常
- [ ] 列表滑动流畅（60fps）
- [ ] Wheel Picker 滚动灵敏度适中

### 9.3 加载状态

- [ ] 数据加载时显示 ActivityIndicator
- [ ] 加载完成后 indicator 消失
- [ ] 空数据显示空状态提示，非加载中

### 9.4 键盘处理

- [ ] 备注输入时键盘弹出，内容不被遮挡
- [ ] 分类名输入时键盘弹出，输入框可见
- [ ] 键盘收起后页面布局恢复正常

---

## 10. 回归检查项

每次修改后重点验证以下核心路径：

| # | 关键路径 | 验证要点 |
|---|---------|---------|
| 1 | 新建支出 | 金额输入 → 选分类 → 提交 → 余额扣减 → 列表刷新 |
| 2 | 新建收入 | 切换类型 → 输入 → 提交 → 余额增加 |
| 3 | 新建转账 | 选源/目标账户 → 输入 → 提交 → 双向余额变更 |
| 4 | 删除交易 | 长按 → 确认 → 余额回退 → 统计更新 |
| 5 | 查看统计 | 周/月/年切换 → 图表正确 → 分类占比正确 |
| 6 | 管理分类 | 新建 → 编辑 → 删除 → 记账中可用 |
| 7 | 智能建议 | 输入历史备注 → chip 出现 → 点击自动填充 |

---

*最后更新: 2026-01-28*
